name: Publish to PyPI

on:
  push:
    branches:
      - das-node-29

  # workflow_dispatch:
  #   inputs:
  #     version:
  #       description: "Version"
  #       required: true

jobs:
  # tag:
  #   uses: singnet/das/.github/workflows/run-semver.yml@master
  #   with:
  #     version: ${{ github.event.inputs.version }}
  #     version-strategy: bump-version-from-variable-value
  #     job-image-namespace: trueagi
  #     job-image-version-semver: semantic-versioning
  #     main-branch: master
  #     version-tag-regex-pattern: /^\d+\.\d+\.\d+$/
  #     version-require-confirmation: "true"
  #     title: New version of hyperon-das-node
  #     deliverable: Library in PyPI named hyperon-das-node
  #   secrets: inherit

  build:
    runs-on: ubuntu-22.04
    # needs: tag
    # if: github.ref == 'refs/heads/master'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build (Docker Image)
        run: ./scripts/docker_image_build.sh

      - name: Build (Bazel)
        run: ./scripts/build.sh

      - name: Build (Docker Image Wheel)
        run: ./scripts/docker_image_wheel.sh

      - name: Build (Wheel)
        run: ./scripts/wheel.sh

      - name: Install twine
        run: pip install twine
        
      - name: Publish Package
        run: twine upload wheelhouse/* --username __token__ --password ${{ secrets.PYPI_API_TOKEN }} --non-interactive
